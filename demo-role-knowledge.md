# 角色记忆系统演示

## 演示步骤

### 1. 创建角色
1. 启动应用：`npm run dev`
2. 访问主页，点击右上角的 + 号
3. 创建一个角色，例如：
   - 名称：奶奶
   - 描述：慈祥的奶奶，喜欢讲故事
   - 背景：退休教师，有很多人生智慧

### 2. 添加记忆
1. 在主页找到刚创建的角色卡片
2. 点击角色卡片上的记忆图标（书本图标）
3. 进入记忆管理页面
4. 添加一些记忆，例如：

```
记忆1：
奶奶年轻时是一名小学老师，教了30年书。她总是说"教书育人是最有意义的工作"。

记忆2：
奶奶最拿手的菜是红烧肉，每次家庭聚会都会做这道菜。她说秘诀是要用冰糖炒糖色。

记忆3：
奶奶喜欢在晚饭后和家人一起看新闻联播，然后会评论时事，分享她的看法。

记忆4：
奶奶有一个习惯，每天早上都会在小区里散步一小时，认识了很多邻居。
```

### 3. 测试文件上传
1. 创建一个文本文件 `grandma-stories.txt`：
```
奶奶小时候家里很穷，但她的父母很重视教育。
奶奶说她最难忘的是第一次当老师时的紧张心情。
奶奶年轻时很漂亮，有很多追求者，但她选择了爷爷因为他人品好。
奶奶退休后学会了使用智能手机，还会发微信表情包。
```

2. 在记忆管理页面点击"上传文件"
3. 选择刚创建的文本文件
4. 验证记忆是否正确添加

### 4. 测试 AI 对话
1. 返回主页，点击角色卡片进入聊天
2. 发送一些消息测试 AI 是否使用了记忆：

```
用户：奶奶，你年轻时做什么工作？
预期回复：应该提到教师职业和30年教书经历

用户：你最拿手的菜是什么？
预期回复：应该提到红烧肉和冰糖炒糖色的秘诀

用户：你平时有什么爱好？
预期回复：应该提到散步、看新闻等习惯
```

### 5. 测试记忆编辑
1. 返回记忆管理页面
2. 点击某条记忆的编辑按钮
3. 修改内容并保存
4. 返回聊天测试修改是否生效

### 6. 测试记忆删除
1. 在记忆管理页面删除一条记忆
2. 返回聊天测试相关内容是否不再出现

## API 测试

### 使用 curl 测试 API

```bash
# 1. 获取角色记忆
curl -X GET "http://localhost:3000/api/role/{roleId}/knowledge" \
  -H "Content-Type: application/json"

# 2. 添加记忆
curl -X POST "http://localhost:3000/api/role/{roleId}/knowledge" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "这是一条测试记忆",
    "type": "text"
  }'

# 3. 批量添加记忆
curl -X POST "http://localhost:3000/api/role/{roleId}/knowledge/batch" \
  -H "Content-Type: application/json" \
  -d '{
    "contents": ["记忆1", "记忆2", "记忆3"],
    "type": "text"
  }'

# 4. 更新记忆
curl -X PUT "http://localhost:3000/api/knowledge/{knowledgeId}" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "更新后的记忆内容"
  }'

# 5. 删除记忆
curl -X DELETE "http://localhost:3000/api/knowledge/{knowledgeId}"
```

## 验证要点

### ✅ 功能验证
- [ ] 角色创建成功
- [ ] 记忆添加成功（文本输入）
- [ ] 记忆添加成功（文件上传）
- [ ] 记忆列表正确显示
- [ ] 记忆编辑功能正常
- [ ] 记忆删除功能正常
- [ ] AI 对话使用记忆内容
- [ ] 不同角色的记忆相互独立

### ✅ 界面验证
- [ ] 记忆管理页面布局正确
- [ ] 角色卡片显示记忆图标
- [ ] 加载状态显示正常
- [ ] 错误状态处理正确
- [ ] 空状态提示友好

### ✅ 性能验证
- [ ] 记忆加载速度合理
- [ ] 文件上传响应及时
- [ ] AI 回复生成速度正常
- [ ] 页面切换流畅

## 常见问题

### Q: 记忆没有在对话中体现
A: 检查以下几点：
1. 确认记忆已成功添加到角色
2. 检查 DeepSeek API Key 是否配置正确
3. 查看服务器日志是否有错误

### Q: 文件上传失败
A: 确认：
1. 文件格式为 .txt, .md, .json
2. 文件内容为纯文本
3. 文件大小合理

### Q: 记忆编辑不生效
A: 检查：
1. 网络连接是否正常
2. 是否有权限编辑该记忆
3. 内容是否为空

## 下一步开发

1. **搜索功能**：在记忆中搜索特定内容
2. **标签系统**：为记忆添加分类标签
3. **导入导出**：批量管理记忆数据
4. **记忆统计**：显示记忆数量和使用情况
